Refactoring the front-end code. Work in progress.